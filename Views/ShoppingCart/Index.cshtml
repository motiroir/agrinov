@using AgriNov.Models
@model AgriNov.Models.ShoppingCart
@{
    Layout = "_BaseLayout";
    ViewBag.Title = "Mon panier";
}
@section ExtraStyle {
    <link rel="stylesheet" href="~/CSS/formstyle.css" />
    <style>
        .cart {
            margin-top: 200px;
        }
    </style>
}
<div class="cart">
        <h2>Votre panier</h2>
        @if (Model.ShoppingCartItems.Any())
        {
            using(Html.BeginForm("Index", "ShoppingCart", FormMethod.Post))
            {
                <table class="table">
                   
                    <thead>
                        <tr>
                            <th colspan="2">Article</th>
                            <th>Quantité</th>
                            <th>Prix</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.ShoppingCartItems.Count ; i++)
                        {
                            ShoppingCartItem item = Model.ShoppingCartItems[i];
                            <tr>
                                <td>
                                    @if (item.MemberShipFee != null)
                                    {
                                        <img src="~/img/global/Logo.png" alt="image cotisation">
                                    }
                                    else if(item.Product != null)
                                    {
                                        <img src="~/img/global/Logo.png" alt="image produit">
                                    }
                                </td>
                                <td>
                                    @if (item.MemberShipFee != null)
                                    {
                                        @("Cotisation annuelle")
                                    }
                                    else if(item.Product != null)
                                    {
                                        @item.Product.Name
                                    }
                                </td>
                                <td>
                                    @if (item.MemberShipFee != null)
                                    {
                                        @item.Quantity
                                    }
                                    else if(item.Product != null)
                                    {
                                        @Html.TextBoxFor(m=> m.ShoppingCartItems[i].Quantity, new { type = "number", min = "0", max = item.Product.Stock, oninvalid="this.SetCustomValidity('La quantité ne peut pas être supérieure au stock')", oninput="this.SetCustomValidity('')"})
                                        @Html.ValidationMessageFor(m => m.ShoppingCartItems[i].Quantity)
                                    }
                                </td>
                                <td>
                                    @if (item.MemberShipFee != null)
                                    {
                                        @item.MemberShipFee.Price.ToString("C")
                                    }
                                    else if(item.Product != null)
                                    {
                                        @item.Product.Price.ToString("C")
                                    }
                                </td>
                                <td>@item.Total.ToString("C")</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <div>
                    <strong>Total:</strong> @Model.Total.ToString("C")
                </div>
                <button type="submit">Mettre à jour le panier</button>
            }
            <a href='@Url.Action("EmptyCart","ShoppingCart")'>Vider le panier</a>
            <a href='@Url.Action("PlaceOrder","ShoppingCart")'>Passer commande</a>
        }
        else
        {
            <p>Votre panier est vide</p>
        }
</div>
